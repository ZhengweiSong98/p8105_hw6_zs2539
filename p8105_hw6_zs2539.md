HW6 Solution
================
Zhengwei Song

## Problem 2

## Importing the dataset

``` r
homicide_raw <- read_csv("https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv")
```

#### Creating a `city_state` variable, binary variable `resolution` indicating case disposition, omitting cities excluded victim race and Tulsa, AL with data entry mistake. Also, limiting `victim_race` is white or black, making `victim_age` numeric.

``` r
homicide_df = homicide_raw %>% 
    janitor::clean_names() %>%
    mutate(
        reported_date = as.Date(as.character(reported_date), format = "%Y%m%d"),
        city_state = str_c(city, state, sep = ", "),
        resolved = as.numeric(disposition == "Closed by arrest"),
        victim_age = as.numeric(victim_age),
        victim_race = fct_relevel(victim_race, "White")
    ) %>%
    relocate(city_state) %>%
    filter(city_state != c("Tulsa, AL","Dallas, TX","Phoenix, AZ","Kansas City, MO"),
           victim_race == c("White","Black"))
```

#### Applying `glm` to fit a logistic regression with resolved vs unresolved as the outcome; victim age, sex and race as predictors. Also, saving the output of `glm` as an R object.

``` r
baltimore_logistic = homicide_df %>%
    filter(city_state == "Baltimore, MD") %>%
    glm(resolved ~ victim_age + victim_race + victim_sex, data = ., family = binomial()) 
```

#### Applying the `broom::tidy` to the above object; Obtaining the estimate and confidence interval of the adjusted odds ratio, for solving homicides comparing male victims to female victims keeping all other variables fixed.

``` r
baltimore_logistic %>% 
  broom::tidy() %>% 
  mutate(OR = exp(estimate),
         ci_lower = quantile(OR, 0.025),
        ci_upper = quantile(OR, 0.975)) %>%
  select(term, log_OR = estimate, OR,ci_lower,ci_upper, p.value) %>% 
  knitr::kable(digits = 3)
```

| term             | log_OR |    OR | ci_lower | ci_upper | p.value |
|:-----------------|-------:|------:|---------:|---------:|--------:|
| (Intercept)      |  1.421 | 4.140 |    0.391 |    3.904 |   0.000 |
| victim_age       | -0.011 | 0.989 |    0.391 |    3.904 |   0.027 |
| victim_raceBlack | -0.923 | 0.397 |    0.391 |    3.904 |   0.000 |
| victim_sexMale   | -0.940 | 0.391 |    0.391 |    3.904 |   0.000 |

- Keeping all other variables fixed, in Baltimore, MD, homicides in
  which the victim is male are significantly less like to be resolved
  than those in which the victim is female.

## Running `glm` for each of the cities in the dataset; Extracting the adjusted odds ratio and CI, for solving homicides comparing male victims to female victims;

``` r
allcities_logistic = homicide_df %>% 
  nest(data = -city_state) %>% 
  mutate(
    models = map(data, ~glm(resolved ~ victim_age + victim_race + victim_sex, data = ., family = binomial())),
    results = map(models, broom::tidy)) %>% 
  select(-data, -models) %>% 
  unnest(results)
```

``` r
allcities_logistic %>%
  mutate(term = fct_inorder(term),
         OR = exp(estimate),
         ci_lower = quantile(OR, 0.025),
        ci_upper = quantile(OR, 0.975)) %>%
    select(city_state, term, log_OR = estimate, OR, ci_lower,ci_upper,p.value) %>% 
  knitr::kable(digits = 3)
```

| city_state         | term              |  log_OR |     OR | ci_lower | ci_upper | p.value |
|:-------------------|:------------------|--------:|-------:|---------:|---------:|--------:|
| Albuquerque, NM    | (Intercept)       |   1.162 |  3.196 |    0.146 |    7.572 |   0.078 |
| Albuquerque, NM    | victim_age        |  -0.025 |  0.975 |    0.146 |    7.572 |   0.074 |
| Albuquerque, NM    | victim_raceBlack  |  -0.938 |  0.391 |    0.146 |    7.572 |   0.115 |
| Albuquerque, NM    | victim_sexMale    |   0.736 |  2.088 |    0.146 |    7.572 |   0.188 |
| Albuquerque, NM    | victim_sexUnknown | -15.002 |  0.000 |    0.146 |    7.572 |   0.992 |
| Atlanta, GA        | (Intercept)       |   0.607 |  1.835 |    0.146 |    7.572 |   0.251 |
| Atlanta, GA        | victim_age        |  -0.016 |  0.984 |    0.146 |    7.572 |   0.019 |
| Atlanta, GA        | victim_raceBlack  |   0.246 |  1.279 |    0.146 |    7.572 |   0.541 |
| Atlanta, GA        | victim_sexMale    |   0.296 |  1.344 |    0.146 |    7.572 |   0.262 |
| Baltimore, MD      | (Intercept)       |   1.421 |  4.140 |    0.146 |    7.572 |   0.000 |
| Baltimore, MD      | victim_age        |  -0.011 |  0.989 |    0.146 |    7.572 |   0.027 |
| Baltimore, MD      | victim_raceBlack  |  -0.923 |  0.397 |    0.146 |    7.572 |   0.000 |
| Baltimore, MD      | victim_sexMale    |  -0.940 |  0.391 |    0.146 |    7.572 |   0.000 |
| Baton Rouge, LA    | (Intercept)       |   1.728 |  5.629 |    0.146 |    7.572 |   0.025 |
| Baton Rouge, LA    | victim_age        |  -0.008 |  0.992 |    0.146 |    7.572 |   0.499 |
| Baton Rouge, LA    | victim_raceBlack  |  -0.217 |  0.805 |    0.146 |    7.572 |   0.705 |
| Baton Rouge, LA    | victim_sexMale    |  -1.373 |  0.253 |    0.146 |    7.572 |   0.003 |
| Birmingham, AL     | (Intercept)       |   0.873 |  2.395 |    0.146 |    7.572 |   0.113 |
| Birmingham, AL     | victim_age        |  -0.003 |  0.997 |    0.146 |    7.572 |   0.649 |
| Birmingham, AL     | victim_raceBlack  |  -0.253 |  0.776 |    0.146 |    7.572 |   0.509 |
| Birmingham, AL     | victim_sexMale    |  -0.406 |  0.666 |    0.146 |    7.572 |   0.172 |
| Boston, MA         | (Intercept)       |   1.877 |  6.532 |    0.146 |    7.572 |   0.017 |
| Boston, MA         | victim_age        |   0.003 |  1.003 |    0.146 |    7.572 |   0.830 |
| Boston, MA         | victim_raceBlack  |  -2.183 |  0.113 |    0.146 |    7.572 |   0.000 |
| Boston, MA         | victim_sexMale    |  -0.068 |  0.934 |    0.146 |    7.572 |   0.874 |
| Boston, MA         | victim_sexUnknown |  -0.395 |  0.674 |    0.146 |    7.572 |   0.788 |
| Buffalo, NY        | (Intercept)       |   0.362 |  1.437 |    0.146 |    7.572 |   0.605 |
| Buffalo, NY        | victim_age        |   0.019 |  1.019 |    0.146 |    7.572 |   0.070 |
| Buffalo, NY        | victim_raceBlack  |  -0.968 |  0.380 |    0.146 |    7.572 |   0.020 |
| Buffalo, NY        | victim_sexMale    |  -0.601 |  0.548 |    0.146 |    7.572 |   0.212 |
| Charlotte, NC      | (Intercept)       |   0.953 |  2.594 |    0.146 |    7.572 |   0.096 |
| Charlotte, NC      | victim_age        |   0.011 |  1.011 |    0.146 |    7.572 |   0.223 |
| Charlotte, NC      | victim_raceBlack  |  -0.073 |  0.929 |    0.146 |    7.572 |   0.851 |
| Charlotte, NC      | victim_sexMale    |  -0.425 |  0.654 |    0.146 |    7.572 |   0.239 |
| Chicago, IL        | (Intercept)       |   0.172 |  1.188 |    0.146 |    7.572 |   0.500 |
| Chicago, IL        | victim_age        |   0.003 |  1.003 |    0.146 |    7.572 |   0.421 |
| Chicago, IL        | victim_raceBlack  |  -0.558 |  0.573 |    0.146 |    7.572 |   0.003 |
| Chicago, IL        | victim_sexMale    |  -0.923 |  0.397 |    0.146 |    7.572 |   0.000 |
| Cincinnati, OH     | (Intercept)       |   2.357 | 10.559 |    0.146 |    7.572 |   0.000 |
| Cincinnati, OH     | victim_age        |  -0.011 |  0.989 |    0.146 |    7.572 |   0.213 |
| Cincinnati, OH     | victim_raceBlack  |  -0.966 |  0.381 |    0.146 |    7.572 |   0.015 |
| Cincinnati, OH     | victim_sexMale    |  -1.009 |  0.364 |    0.146 |    7.572 |   0.012 |
| Columbus, OH       | (Intercept)       |   0.272 |  1.313 |    0.146 |    7.572 |   0.456 |
| Columbus, OH       | victim_age        |   0.010 |  1.010 |    0.146 |    7.572 |   0.134 |
| Columbus, OH       | victim_raceBlack  |  -0.164 |  0.849 |    0.146 |    7.572 |   0.456 |
| Columbus, OH       | victim_sexMale    |  -0.497 |  0.609 |    0.146 |    7.572 |   0.055 |
| Denver, CO         | (Intercept)       |   1.062 |  2.893 |    0.146 |    7.572 |   0.136 |
| Denver, CO         | victim_age        |  -0.017 |  0.983 |    0.146 |    7.572 |   0.174 |
| Denver, CO         | victim_raceBlack  |  -0.258 |  0.772 |    0.146 |    7.572 |   0.549 |
| Denver, CO         | victim_sexMale    |  -0.351 |  0.704 |    0.146 |    7.572 |   0.526 |
| Detroit, MI        | (Intercept)       |   0.250 |  1.284 |    0.146 |    7.572 |   0.364 |
| Detroit, MI        | victim_age        |   0.005 |  1.005 |    0.146 |    7.572 |   0.223 |
| Detroit, MI        | victim_raceBlack  |  -0.357 |  0.700 |    0.146 |    7.572 |   0.074 |
| Detroit, MI        | victim_sexMale    |  -0.547 |  0.579 |    0.146 |    7.572 |   0.001 |
| Durham, NC         | (Intercept)       |   0.978 |  2.660 |    0.146 |    7.572 |   0.254 |
| Durham, NC         | victim_age        |   0.001 |  1.001 |    0.146 |    7.572 |   0.968 |
| Durham, NC         | victim_raceBlack  |  -0.056 |  0.946 |    0.146 |    7.572 |   0.937 |
| Durham, NC         | victim_sexMale    |  -0.342 |  0.710 |    0.146 |    7.572 |   0.570 |
| Fort Worth, TX     | (Intercept)       |   1.541 |  4.671 |    0.146 |    7.572 |   0.004 |
| Fort Worth, TX     | victim_age        |  -0.027 |  0.974 |    0.146 |    7.572 |   0.003 |
| Fort Worth, TX     | victim_raceBlack  |  -0.312 |  0.732 |    0.146 |    7.572 |   0.321 |
| Fort Worth, TX     | victim_sexMale    |  -0.344 |  0.709 |    0.146 |    7.572 |   0.324 |
| Fresno, CA         | (Intercept)       |   0.969 |  2.637 |    0.146 |    7.572 |   0.299 |
| Fresno, CA         | victim_age        |   0.018 |  1.018 |    0.146 |    7.572 |   0.236 |
| Fresno, CA         | victim_raceBlack  |  -1.387 |  0.250 |    0.146 |    7.572 |   0.025 |
| Fresno, CA         | victim_sexMale    |   0.411 |  1.509 |    0.146 |    7.572 |   0.520 |
| Houston, TX        | (Intercept)       |   0.864 |  2.373 |    0.146 |    7.572 |   0.002 |
| Houston, TX        | victim_age        |  -0.005 |  0.995 |    0.146 |    7.572 |   0.260 |
| Houston, TX        | victim_raceBlack  |  -0.134 |  0.875 |    0.146 |    7.572 |   0.434 |
| Houston, TX        | victim_sexMale    |  -0.637 |  0.529 |    0.146 |    7.572 |   0.000 |
| Indianapolis, IN   | (Intercept)       |   0.983 |  2.674 |    0.146 |    7.572 |   0.003 |
| Indianapolis, IN   | victim_age        |  -0.008 |  0.992 |    0.146 |    7.572 |   0.177 |
| Indianapolis, IN   | victim_raceBlack  |  -0.660 |  0.517 |    0.146 |    7.572 |   0.001 |
| Indianapolis, IN   | victim_sexMale    |  -0.041 |  0.960 |    0.146 |    7.572 |   0.852 |
| Jacksonville, FL   | (Intercept)       |   1.323 |  3.756 |    0.146 |    7.572 |   0.000 |
| Jacksonville, FL   | victim_age        |  -0.012 |  0.988 |    0.146 |    7.572 |   0.047 |
| Jacksonville, FL   | victim_raceBlack  |  -0.623 |  0.536 |    0.146 |    7.572 |   0.002 |
| Jacksonville, FL   | victim_sexMale    |  -0.700 |  0.497 |    0.146 |    7.572 |   0.001 |
| Las Vegas, NV      | (Intercept)       |   0.949 |  2.583 |    0.146 |    7.572 |   0.004 |
| Las Vegas, NV      | victim_age        |  -0.005 |  0.995 |    0.146 |    7.572 |   0.339 |
| Las Vegas, NV      | victim_raceBlack  |  -0.273 |  0.761 |    0.146 |    7.572 |   0.199 |
| Las Vegas, NV      | victim_sexMale    |  -0.142 |  0.868 |    0.146 |    7.572 |   0.552 |
| Long Beach, CA     | (Intercept)       |   3.228 | 25.240 |    0.146 |    7.572 |   0.009 |
| Long Beach, CA     | victim_age        |  -0.015 |  0.985 |    0.146 |    7.572 |   0.368 |
| Long Beach, CA     | victim_raceBlack  |  -0.961 |  0.383 |    0.146 |    7.572 |   0.176 |
| Long Beach, CA     | victim_sexMale    |  -1.468 |  0.230 |    0.146 |    7.572 |   0.067 |
| Los Angeles, CA    | (Intercept)       |   0.819 |  2.269 |    0.146 |    7.572 |   0.035 |
| Los Angeles, CA    | victim_age        |  -0.003 |  0.997 |    0.146 |    7.572 |   0.589 |
| Los Angeles, CA    | victim_raceBlack  |  -0.427 |  0.652 |    0.146 |    7.572 |   0.079 |
| Los Angeles, CA    | victim_sexMale    |  -0.504 |  0.604 |    0.146 |    7.572 |   0.050 |
| Louisville, KY     | (Intercept)       |   1.846 |  6.335 |    0.146 |    7.572 |   0.000 |
| Louisville, KY     | victim_age        |  -0.012 |  0.988 |    0.146 |    7.572 |   0.162 |
| Louisville, KY     | victim_raceBlack  |  -0.734 |  0.480 |    0.146 |    7.572 |   0.015 |
| Louisville, KY     | victim_sexMale    |  -0.792 |  0.453 |    0.146 |    7.572 |   0.024 |
| Memphis, TN        | (Intercept)       |   1.746 |  5.733 |    0.146 |    7.572 |   0.000 |
| Memphis, TN        | victim_age        |  -0.015 |  0.985 |    0.146 |    7.572 |   0.007 |
| Memphis, TN        | victim_raceBlack  |  -0.139 |  0.870 |    0.146 |    7.572 |   0.630 |
| Memphis, TN        | victim_sexMale    |  -0.351 |  0.704 |    0.146 |    7.572 |   0.117 |
| Miami, FL          | (Intercept)       |   0.859 |  2.360 |    0.146 |    7.572 |   0.110 |
| Miami, FL          | victim_age        |  -0.007 |  0.993 |    0.146 |    7.572 |   0.492 |
| Miami, FL          | victim_raceBlack  |  -0.594 |  0.552 |    0.146 |    7.572 |   0.058 |
| Miami, FL          | victim_sexMale    |  -0.891 |  0.410 |    0.146 |    7.572 |   0.014 |
| Milwaukee, wI      | (Intercept)       |   1.888 |  6.609 |    0.146 |    7.572 |   0.000 |
| Milwaukee, wI      | victim_age        |  -0.013 |  0.987 |    0.146 |    7.572 |   0.042 |
| Milwaukee, wI      | victim_raceBlack  |  -0.695 |  0.499 |    0.146 |    7.572 |   0.047 |
| Milwaukee, wI      | victim_sexMale    |  -0.404 |  0.668 |    0.146 |    7.572 |   0.117 |
| Minneapolis, MN    | (Intercept)       |   0.437 |  1.548 |    0.146 |    7.572 |   0.566 |
| Minneapolis, MN    | victim_age        |  -0.005 |  0.995 |    0.146 |    7.572 |   0.664 |
| Minneapolis, MN    | victim_raceBlack  |  -0.869 |  0.419 |    0.146 |    7.572 |   0.085 |
| Minneapolis, MN    | victim_sexMale    |   0.549 |  1.731 |    0.146 |    7.572 |   0.259 |
| Nashville, TN      | (Intercept)       |   0.858 |  2.359 |    0.146 |    7.572 |   0.035 |
| Nashville, TN      | victim_age        |  -0.007 |  0.993 |    0.146 |    7.572 |   0.319 |
| Nashville, TN      | victim_raceBlack  |   0.020 |  1.020 |    0.146 |    7.572 |   0.934 |
| Nashville, TN      | victim_sexMale    |  -0.086 |  0.918 |    0.146 |    7.572 |   0.790 |
| New Orleans, LA    | (Intercept)       |   1.135 |  3.113 |    0.146 |    7.572 |   0.010 |
| New Orleans, LA    | victim_age        |  -0.019 |  0.981 |    0.146 |    7.572 |   0.007 |
| New Orleans, LA    | victim_raceBlack  |  -0.631 |  0.532 |    0.146 |    7.572 |   0.042 |
| New Orleans, LA    | victim_sexMale    |  -0.622 |  0.537 |    0.146 |    7.572 |   0.007 |
| New York, NY       | (Intercept)       |   2.927 | 18.678 |    0.146 |    7.572 |   0.000 |
| New York, NY       | victim_age        |   0.007 |  1.007 |    0.146 |    7.572 |   0.535 |
| New York, NY       | victim_raceBlack  |  -1.259 |  0.284 |    0.146 |    7.572 |   0.015 |
| New York, NY       | victim_sexMale    |  -2.069 |  0.126 |    0.146 |    7.572 |   0.000 |
| Oakland, CA        | (Intercept)       |   2.029 |  7.609 |    0.146 |    7.572 |   0.002 |
| Oakland, CA        | victim_age        |   0.001 |  1.001 |    0.146 |    7.572 |   0.887 |
| Oakland, CA        | victim_raceBlack  |  -1.882 |  0.152 |    0.146 |    7.572 |   0.000 |
| Oakland, CA        | victim_sexMale    |  -0.705 |  0.494 |    0.146 |    7.572 |   0.026 |
| Oklahoma City, OK  | (Intercept)       |   0.788 |  2.199 |    0.146 |    7.572 |   0.066 |
| Oklahoma City, OK  | victim_age        |  -0.008 |  0.992 |    0.146 |    7.572 |   0.372 |
| Oklahoma City, OK  | victim_raceBlack  |  -0.642 |  0.526 |    0.146 |    7.572 |   0.029 |
| Oklahoma City, OK  | victim_sexMale    |  -0.001 |  0.999 |    0.146 |    7.572 |   0.998 |
| Omaha, NE          | (Intercept)       |   2.322 | 10.201 |    0.146 |    7.572 |   0.001 |
| Omaha, NE          | victim_age        |   0.006 |  1.006 |    0.146 |    7.572 |   0.643 |
| Omaha, NE          | victim_raceBlack  |  -2.082 |  0.125 |    0.146 |    7.572 |   0.000 |
| Omaha, NE          | victim_sexMale    |  -1.041 |  0.353 |    0.146 |    7.572 |   0.023 |
| Philadelphia, PA   | (Intercept)       |   1.053 |  2.867 |    0.146 |    7.572 |   0.000 |
| Philadelphia, PA   | victim_age        |   0.002 |  1.002 |    0.146 |    7.572 |   0.678 |
| Philadelphia, PA   | victim_raceBlack  |  -0.341 |  0.711 |    0.146 |    7.572 |   0.092 |
| Philadelphia, PA   | victim_sexMale    |  -0.679 |  0.507 |    0.146 |    7.572 |   0.000 |
| Pittsburgh, PA     | (Intercept)       |   1.284 |  3.611 |    0.146 |    7.572 |   0.016 |
| Pittsburgh, PA     | victim_age        |   0.003 |  1.003 |    0.146 |    7.572 |   0.707 |
| Pittsburgh, PA     | victim_raceBlack  |  -1.201 |  0.301 |    0.146 |    7.572 |   0.003 |
| Pittsburgh, PA     | victim_sexMale    |  -0.555 |  0.574 |    0.146 |    7.572 |   0.086 |
| Richmond, VA       | (Intercept)       |   1.820 |  6.175 |    0.146 |    7.572 |   0.076 |
| Richmond, VA       | victim_age        |  -0.015 |  0.985 |    0.146 |    7.572 |   0.337 |
| Richmond, VA       | victim_raceBlack  |  -0.036 |  0.964 |    0.146 |    7.572 |   0.955 |
| Richmond, VA       | victim_sexMale    |  -0.340 |  0.712 |    0.146 |    7.572 |   0.535 |
| San Antonio, TX    | (Intercept)       |   1.370 |  3.936 |    0.146 |    7.572 |   0.024 |
| San Antonio, TX    | victim_age        |  -0.021 |  0.980 |    0.146 |    7.572 |   0.043 |
| San Antonio, TX    | victim_raceBlack  |  -0.148 |  0.863 |    0.146 |    7.572 |   0.673 |
| San Antonio, TX    | victim_sexMale    |  -0.296 |  0.744 |    0.146 |    7.572 |   0.462 |
| Sacramento, CA     | (Intercept)       |   0.622 |  1.863 |    0.146 |    7.572 |   0.385 |
| Sacramento, CA     | victim_age        |   0.012 |  1.012 |    0.146 |    7.572 |   0.376 |
| Sacramento, CA     | victim_raceBlack  |  -0.364 |  0.695 |    0.146 |    7.572 |   0.428 |
| Sacramento, CA     | victim_sexMale    |  -0.449 |  0.638 |    0.146 |    7.572 |   0.338 |
| Sacramento, CA     | victim_sexUnknown | -16.096 |  0.000 |    0.146 |    7.572 |   0.991 |
| Savannah, GA       | (Intercept)       |   0.194 |  1.214 |    0.146 |    7.572 |   0.818 |
| Savannah, GA       | victim_age        |   0.017 |  1.017 |    0.146 |    7.572 |   0.242 |
| Savannah, GA       | victim_raceBlack  |  -0.266 |  0.766 |    0.146 |    7.572 |   0.625 |
| Savannah, GA       | victim_sexMale    |  -0.624 |  0.536 |    0.146 |    7.572 |   0.243 |
| San Bernardino, CA | (Intercept)       |  -1.631 |  0.196 |    0.146 |    7.572 |   0.175 |
| San Bernardino, CA | victim_age        |   0.039 |  1.040 |    0.146 |    7.572 |   0.042 |
| San Bernardino, CA | victim_raceBlack  |   0.370 |  1.447 |    0.146 |    7.572 |   0.565 |
| San Bernardino, CA | victim_sexMale    |  -0.318 |  0.728 |    0.146 |    7.572 |   0.647 |
| San Diego, CA      | (Intercept)       |   2.023 |  7.561 |    0.146 |    7.572 |   0.014 |
| San Diego, CA      | victim_age        |  -0.011 |  0.989 |    0.146 |    7.572 |   0.380 |
| San Diego, CA      | victim_raceBlack  |  -0.502 |  0.605 |    0.146 |    7.572 |   0.229 |
| San Diego, CA      | victim_sexMale    |  -1.042 |  0.353 |    0.146 |    7.572 |   0.043 |
| San Francisco, CA  | (Intercept)       |   1.020 |  2.772 |    0.146 |    7.572 |   0.148 |
| San Francisco, CA  | victim_age        |   0.017 |  1.017 |    0.146 |    7.572 |   0.092 |
| San Francisco, CA  | victim_raceBlack  |  -0.855 |  0.425 |    0.146 |    7.572 |   0.014 |
| San Francisco, CA  | victim_sexMale    |  -0.910 |  0.403 |    0.146 |    7.572 |   0.096 |
| St. Louis, MO      | (Intercept)       |   0.518 |  1.678 |    0.146 |    7.572 |   0.148 |
| St. Louis, MO      | victim_age        |  -0.001 |  0.999 |    0.146 |    7.572 |   0.881 |
| St. Louis, MO      | victim_raceBlack  |  -0.344 |  0.709 |    0.146 |    7.572 |   0.161 |
| St. Louis, MO      | victim_sexMale    |  -0.445 |  0.641 |    0.146 |    7.572 |   0.022 |
| Stockton, CA       | (Intercept)       |   1.423 |  4.150 |    0.146 |    7.572 |   0.085 |
| Stockton, CA       | victim_age        |  -0.021 |  0.979 |    0.146 |    7.572 |   0.125 |
| Stockton, CA       | victim_raceBlack  |  -1.412 |  0.244 |    0.146 |    7.572 |   0.009 |
| Stockton, CA       | victim_sexMale    |   0.165 |  1.180 |    0.146 |    7.572 |   0.778 |
| Tampa, FL          | (Intercept)       |   0.215 |  1.240 |    0.146 |    7.572 |   0.829 |
| Tampa, FL          | victim_age        |   0.018 |  1.019 |    0.146 |    7.572 |   0.243 |
| Tampa, FL          | victim_raceBlack  |   0.041 |  1.042 |    0.146 |    7.572 |   0.945 |
| Tampa, FL          | victim_sexMale    |  -1.156 |  0.315 |    0.146 |    7.572 |   0.124 |
| Tulsa, OK          | (Intercept)       |   1.554 |  4.732 |    0.146 |    7.572 |   0.000 |
| Tulsa, OK          | victim_age        |  -0.008 |  0.992 |    0.146 |    7.572 |   0.359 |
| Tulsa, OK          | victim_raceBlack  |  -0.364 |  0.695 |    0.146 |    7.572 |   0.213 |
| Tulsa, OK          | victim_sexMale    |  -0.253 |  0.776 |    0.146 |    7.572 |   0.456 |
| Washington, DC     | (Intercept)       |   1.193 |  3.296 |    0.146 |    7.572 |   0.035 |
| Washington, DC     | victim_age        |  -0.003 |  0.997 |    0.146 |    7.572 |   0.643 |
| Washington, DC     | victim_raceBlack  |  -0.503 |  0.605 |    0.146 |    7.572 |   0.270 |
| Washington, DC     | victim_sexMale    |  -0.552 |  0.576 |    0.146 |    7.572 |   0.040 |
| Washington, DC     | victim_sexUnknown |   0.171 |  1.187 |    0.146 |    7.572 |   0.775 |

- Keeping all other variables fixed, in XXX,XXX,XXX, homicides in which
  the victim is male are significantly less like to be resolved than
  those in which the victim is female.

``` r
allcities_logistic %>% 
  filter(str_detect(term, "victim_sex")) %>% 
  ggplot(aes(x = city_state, y = exp(estimate))) + 
  geom_point() + 
  facet_wrap(~term) + 
  theme(axis.text.x = element_text(angle = 80, hjust = 1))
```

<img src="p8105_hw6_zs2539_files/figure-gfm/unnamed-chunk-7-1.png" width="90%" />

## Problem 3

#### Loading and cleaning the data

``` r
birthweight_raw = read_csv("./data/birthweight.csv")

birthweight_df = birthweight_raw %>% 
    janitor::clean_names() %>%
    mutate(across(.cols = c(babysex, frace, malform, mrace), as.factor)) %>%
  mutate(babysex = ifelse(babysex == "1", "male","female"),
         malform = ifelse(malform == "0", "absent","present"),
         frace = recode(frace, "1" = "White", "2" = "Black", "3" = "Asian", 
                        "4" = "Puerto Rican", "8" = "Other", "9" = "Unknown"),
         mrace = recode(mrace, "1" = "White", "2" = "Black", 
                        "3" = "Asian", "4" = "Puerto Rican", "8" = "Other")
         )
```

- `babysex`,`frace`,`malform` and `mrace` were converted from numeric to
  factor, because they are categorical variables.

- These categorical data are `recode` to make it more intuitive.

``` r
skimr::skim(birthweight_df)
```

|                                                  |                |
|:-------------------------------------------------|:---------------|
| Name                                             | birthweight_df |
| Number of rows                                   | 4342           |
| Number of columns                                | 20             |
| \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_   |                |
| Column type frequency:                           |                |
| character                                        | 2              |
| factor                                           | 2              |
| numeric                                          | 16             |
| \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ |                |
| Group variables                                  | None           |

Data summary

**Variable type: character**

| skim_variable | n_missing | complete_rate | min | max | empty | n_unique | whitespace |
|:--------------|----------:|--------------:|----:|----:|------:|---------:|-----------:|
| babysex       |         0 |             1 |   4 |   6 |     0 |        2 |          0 |
| malform       |         0 |             1 |   6 |   7 |     0 |        2 |          0 |

**Variable type: factor**

| skim_variable | n_missing | complete_rate | ordered | n_unique | top_counts                              |
|:--------------|----------:|--------------:|:--------|---------:|:----------------------------------------|
| frace         |         0 |             1 | FALSE   |        5 | Whi: 2123, Bla: 1911, Pue: 248, Asi: 46 |
| mrace         |         0 |             1 | FALSE   |        4 | Whi: 2147, Bla: 1909, Pue: 243, Asi: 43 |

**Variable type: numeric**

| skim_variable | n_missing | complete_rate |    mean |     sd |     p0 |     p25 |     p50 |     p75 |   p100 | hist  |
|:--------------|----------:|--------------:|--------:|-------:|-------:|--------:|--------:|--------:|-------:|:------|
| bhead         |         0 |             1 |   33.65 |   1.62 |  21.00 |   33.00 |   34.00 |   35.00 |   41.0 | ▁▁▆▇▁ |
| blength       |         0 |             1 |   49.75 |   2.72 |  20.00 |   48.00 |   50.00 |   51.00 |   63.0 | ▁▁▁▇▁ |
| bwt           |         0 |             1 | 3114.40 | 512.15 | 595.00 | 2807.00 | 3132.50 | 3459.00 | 4791.0 | ▁▁▇▇▁ |
| delwt         |         0 |             1 |  145.57 |  22.21 |  86.00 |  131.00 |  143.00 |  157.00 |  334.0 | ▅▇▁▁▁ |
| fincome       |         0 |             1 |   44.11 |  25.98 |   0.00 |   25.00 |   35.00 |   65.00 |   96.0 | ▃▇▅▂▃ |
| gaweeks       |         0 |             1 |   39.43 |   3.15 |  17.70 |   38.30 |   39.90 |   41.10 |   51.3 | ▁▁▂▇▁ |
| menarche      |         0 |             1 |   12.51 |   1.48 |   0.00 |   12.00 |   12.00 |   13.00 |   19.0 | ▁▁▂▇▁ |
| mheight       |         0 |             1 |   63.49 |   2.66 |  48.00 |   62.00 |   63.00 |   65.00 |   77.0 | ▁▁▇▂▁ |
| momage        |         0 |             1 |   20.30 |   3.88 |  12.00 |   18.00 |   20.00 |   22.00 |   44.0 | ▅▇▂▁▁ |
| parity        |         0 |             1 |    0.00 |   0.10 |   0.00 |    0.00 |    0.00 |    0.00 |    6.0 | ▇▁▁▁▁ |
| pnumlbw       |         0 |             1 |    0.00 |   0.00 |   0.00 |    0.00 |    0.00 |    0.00 |    0.0 | ▁▁▇▁▁ |
| pnumsga       |         0 |             1 |    0.00 |   0.00 |   0.00 |    0.00 |    0.00 |    0.00 |    0.0 | ▁▁▇▁▁ |
| ppbmi         |         0 |             1 |   21.57 |   3.18 |  13.07 |   19.53 |   21.03 |   22.91 |   46.1 | ▃▇▁▁▁ |
| ppwt          |         0 |             1 |  123.49 |  20.16 |  70.00 |  110.00 |  120.00 |  134.00 |  287.0 | ▅▇▁▁▁ |
| smoken        |         0 |             1 |    4.15 |   7.41 |   0.00 |    0.00 |    0.00 |    5.00 |   60.0 | ▇▁▁▁▁ |
| wtgain        |         0 |             1 |   22.08 |  10.94 | -46.00 |   15.00 |   22.00 |   28.00 |   89.0 | ▁▁▇▁▁ |

- There is no missing data. The cleaned dataset contains 4342
  observations and 20 variables: babysex, bhead, blength, bwt, delwt,
  fincome, frace, gaweeks, malform, menarche, mheight, momage, mrace,
  parity, pnumlbw, pnumsga, ppbmi, ppwt, smoken, wtgain

#### The Correlations with Birth Weight

``` r
birthweight_raw %>% 
  cor_mat() %>%
  cor_gather() %>%
  filter(var1 %in% "bwt") %>%
  filter(!var2 %in% "bwt") %>%
  mutate(
    sig_p = ifelse(p < 0.01, T, F),
    cor_if_sig = ifelse(p < 0.01, cor, NA)
    ) %>% 
  ggplot(aes(
    x = var1, 
    y = var2, 
    fill = cor,
    label = round(cor_if_sig, 2))) + 
  geom_tile(color = "white") +   
  geom_text(
    color = "white",
    size = 4
  ) + 
  scale_x_discrete(
    labels = c("Birth Weight")
  ) + 
  labs(
    x = "Outcome",
    y = "Predictors",
    title = "Correlations between predictors and outcome",
    subtitle = "significant predictors at significance level 0.01",
    fill = "Correlation"
  )
```

<img src="p8105_hw6_zs2539_files/figure-gfm/unnamed-chunk-10-1.png" width="90%" />
\* Based on t-test, the variables with p-value less than 0.01 are to be
selected as predictors. To simple, the continuous are to be selected.
