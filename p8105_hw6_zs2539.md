HW6 Solution
================
Zhengwei Song

## Problem 2

## Importing the dataset

``` r
homicide_raw <- read_csv("https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv")
```

#### Creating a `city_state` variable, binary variable `resolution` indicating case disposition, omitting cities excluded victim race and Tulsa, AL with data entry mistake. Also, limiting `victim_race` is white or black, making `victim_age` numeric.

``` r
homicide_df = homicide_raw %>% 
    janitor::clean_names() %>%
    mutate(
        reported_date = as.Date(as.character(reported_date), format = "%Y%m%d"),
        city_state = str_c(city, state, sep = ", "),
        resolved = as.numeric(disposition == "Closed by arrest"),
        victim_age = as.numeric(victim_age),
        victim_race = fct_relevel(victim_race, "White")
    ) %>%
    relocate(city_state) %>%
    filter(city_state != c("Tulsa, AL","Dallas, TX","Phoenix, AZ","Kansas City, MO"),
           victim_race == c("White","Black"))
```

#### Applying `glm` to fit a logistic regression with resolved vs unresolved as the outcome; victim age, sex and race as predictors. Also, saving the output of `glm` as an R object.

``` r
baltimore_logistic = homicide_df %>%
    filter(city_state == "Baltimore, MD") %>%
    glm(resolved ~ victim_age + victim_race + victim_sex, data = ., family = binomial()) 
```

#### Applying the `broom::tidy` to the above object; Obtaining the estimate and confidence interval of the adjusted odds ratio, for solving homicides comparing male victims to female victims keeping all other variables fixed.

``` r
baltimore_logistic %>% 
  broom::tidy() %>% 
  mutate(OR = exp(estimate)) %>%
  select(term, log_OR = estimate, OR, p.value) %>% 
  knitr::kable(digits = 3)
```

| term             | log_OR |    OR | p.value |
|:-----------------|-------:|------:|--------:|
| (Intercept)      |  1.421 | 4.140 |   0.000 |
| victim_age       | -0.011 | 0.989 |   0.027 |
| victim_raceBlack | -0.923 | 0.397 |   0.000 |
| victim_sexMale   | -0.940 | 0.391 |   0.000 |

- Keeping all other variables fixed, in Baltimore, MD, homicides in
  which the victim is male are significantly less like to be resolved
  than those in which the victim is female.

## Running `glm` for each of the cities in the dataset; Extracting the adjusted odds ratio and CI, for solving homicides comparing male victims to female victims;

``` r
allcities_logistic = homicide_df %>% 
  nest(data = -city_state) %>% 
  mutate(
    models = map(data, ~glm(resolved ~ victim_age + victim_race + victim_sex, data = ., family = binomial())),
    results = map(models, broom::tidy)) %>% 
  select(-data, -models) %>% 
  unnest(results)
```

``` r
allcities_logistic %>%
  mutate(term = fct_inorder(term),
         OR = exp(estimate)) %>%
    select(city_state, term, log_OR = estimate, OR, p.value) %>% 
  knitr::kable(digits = 3)
```

| city_state         | term              |  log_OR |     OR | p.value |
|:-------------------|:------------------|--------:|-------:|--------:|
| Albuquerque, NM    | (Intercept)       |   1.162 |  3.196 |   0.078 |
| Albuquerque, NM    | victim_age        |  -0.025 |  0.975 |   0.074 |
| Albuquerque, NM    | victim_raceBlack  |  -0.938 |  0.391 |   0.115 |
| Albuquerque, NM    | victim_sexMale    |   0.736 |  2.088 |   0.188 |
| Albuquerque, NM    | victim_sexUnknown | -15.002 |  0.000 |   0.992 |
| Atlanta, GA        | (Intercept)       |   0.607 |  1.835 |   0.251 |
| Atlanta, GA        | victim_age        |  -0.016 |  0.984 |   0.019 |
| Atlanta, GA        | victim_raceBlack  |   0.246 |  1.279 |   0.541 |
| Atlanta, GA        | victim_sexMale    |   0.296 |  1.344 |   0.262 |
| Baltimore, MD      | (Intercept)       |   1.421 |  4.140 |   0.000 |
| Baltimore, MD      | victim_age        |  -0.011 |  0.989 |   0.027 |
| Baltimore, MD      | victim_raceBlack  |  -0.923 |  0.397 |   0.000 |
| Baltimore, MD      | victim_sexMale    |  -0.940 |  0.391 |   0.000 |
| Baton Rouge, LA    | (Intercept)       |   1.728 |  5.629 |   0.025 |
| Baton Rouge, LA    | victim_age        |  -0.008 |  0.992 |   0.499 |
| Baton Rouge, LA    | victim_raceBlack  |  -0.217 |  0.805 |   0.705 |
| Baton Rouge, LA    | victim_sexMale    |  -1.373 |  0.253 |   0.003 |
| Birmingham, AL     | (Intercept)       |   0.873 |  2.395 |   0.113 |
| Birmingham, AL     | victim_age        |  -0.003 |  0.997 |   0.649 |
| Birmingham, AL     | victim_raceBlack  |  -0.253 |  0.776 |   0.509 |
| Birmingham, AL     | victim_sexMale    |  -0.406 |  0.666 |   0.172 |
| Boston, MA         | (Intercept)       |   1.877 |  6.532 |   0.017 |
| Boston, MA         | victim_age        |   0.003 |  1.003 |   0.830 |
| Boston, MA         | victim_raceBlack  |  -2.183 |  0.113 |   0.000 |
| Boston, MA         | victim_sexMale    |  -0.068 |  0.934 |   0.874 |
| Boston, MA         | victim_sexUnknown |  -0.395 |  0.674 |   0.788 |
| Buffalo, NY        | (Intercept)       |   0.362 |  1.437 |   0.605 |
| Buffalo, NY        | victim_age        |   0.019 |  1.019 |   0.070 |
| Buffalo, NY        | victim_raceBlack  |  -0.968 |  0.380 |   0.020 |
| Buffalo, NY        | victim_sexMale    |  -0.601 |  0.548 |   0.212 |
| Charlotte, NC      | (Intercept)       |   0.953 |  2.594 |   0.096 |
| Charlotte, NC      | victim_age        |   0.011 |  1.011 |   0.223 |
| Charlotte, NC      | victim_raceBlack  |  -0.073 |  0.929 |   0.851 |
| Charlotte, NC      | victim_sexMale    |  -0.425 |  0.654 |   0.239 |
| Chicago, IL        | (Intercept)       |   0.172 |  1.188 |   0.500 |
| Chicago, IL        | victim_age        |   0.003 |  1.003 |   0.421 |
| Chicago, IL        | victim_raceBlack  |  -0.558 |  0.573 |   0.003 |
| Chicago, IL        | victim_sexMale    |  -0.923 |  0.397 |   0.000 |
| Cincinnati, OH     | (Intercept)       |   2.357 | 10.559 |   0.000 |
| Cincinnati, OH     | victim_age        |  -0.011 |  0.989 |   0.213 |
| Cincinnati, OH     | victim_raceBlack  |  -0.966 |  0.381 |   0.015 |
| Cincinnati, OH     | victim_sexMale    |  -1.009 |  0.364 |   0.012 |
| Columbus, OH       | (Intercept)       |   0.272 |  1.313 |   0.456 |
| Columbus, OH       | victim_age        |   0.010 |  1.010 |   0.134 |
| Columbus, OH       | victim_raceBlack  |  -0.164 |  0.849 |   0.456 |
| Columbus, OH       | victim_sexMale    |  -0.497 |  0.609 |   0.055 |
| Denver, CO         | (Intercept)       |   1.062 |  2.893 |   0.136 |
| Denver, CO         | victim_age        |  -0.017 |  0.983 |   0.174 |
| Denver, CO         | victim_raceBlack  |  -0.258 |  0.772 |   0.549 |
| Denver, CO         | victim_sexMale    |  -0.351 |  0.704 |   0.526 |
| Detroit, MI        | (Intercept)       |   0.250 |  1.284 |   0.364 |
| Detroit, MI        | victim_age        |   0.005 |  1.005 |   0.223 |
| Detroit, MI        | victim_raceBlack  |  -0.357 |  0.700 |   0.074 |
| Detroit, MI        | victim_sexMale    |  -0.547 |  0.579 |   0.001 |
| Durham, NC         | (Intercept)       |   0.978 |  2.660 |   0.254 |
| Durham, NC         | victim_age        |   0.001 |  1.001 |   0.968 |
| Durham, NC         | victim_raceBlack  |  -0.056 |  0.946 |   0.937 |
| Durham, NC         | victim_sexMale    |  -0.342 |  0.710 |   0.570 |
| Fort Worth, TX     | (Intercept)       |   1.541 |  4.671 |   0.004 |
| Fort Worth, TX     | victim_age        |  -0.027 |  0.974 |   0.003 |
| Fort Worth, TX     | victim_raceBlack  |  -0.312 |  0.732 |   0.321 |
| Fort Worth, TX     | victim_sexMale    |  -0.344 |  0.709 |   0.324 |
| Fresno, CA         | (Intercept)       |   0.969 |  2.637 |   0.299 |
| Fresno, CA         | victim_age        |   0.018 |  1.018 |   0.236 |
| Fresno, CA         | victim_raceBlack  |  -1.387 |  0.250 |   0.025 |
| Fresno, CA         | victim_sexMale    |   0.411 |  1.509 |   0.520 |
| Houston, TX        | (Intercept)       |   0.864 |  2.373 |   0.002 |
| Houston, TX        | victim_age        |  -0.005 |  0.995 |   0.260 |
| Houston, TX        | victim_raceBlack  |  -0.134 |  0.875 |   0.434 |
| Houston, TX        | victim_sexMale    |  -0.637 |  0.529 |   0.000 |
| Indianapolis, IN   | (Intercept)       |   0.983 |  2.674 |   0.003 |
| Indianapolis, IN   | victim_age        |  -0.008 |  0.992 |   0.177 |
| Indianapolis, IN   | victim_raceBlack  |  -0.660 |  0.517 |   0.001 |
| Indianapolis, IN   | victim_sexMale    |  -0.041 |  0.960 |   0.852 |
| Jacksonville, FL   | (Intercept)       |   1.323 |  3.756 |   0.000 |
| Jacksonville, FL   | victim_age        |  -0.012 |  0.988 |   0.047 |
| Jacksonville, FL   | victim_raceBlack  |  -0.623 |  0.536 |   0.002 |
| Jacksonville, FL   | victim_sexMale    |  -0.700 |  0.497 |   0.001 |
| Las Vegas, NV      | (Intercept)       |   0.949 |  2.583 |   0.004 |
| Las Vegas, NV      | victim_age        |  -0.005 |  0.995 |   0.339 |
| Las Vegas, NV      | victim_raceBlack  |  -0.273 |  0.761 |   0.199 |
| Las Vegas, NV      | victim_sexMale    |  -0.142 |  0.868 |   0.552 |
| Long Beach, CA     | (Intercept)       |   3.228 | 25.240 |   0.009 |
| Long Beach, CA     | victim_age        |  -0.015 |  0.985 |   0.368 |
| Long Beach, CA     | victim_raceBlack  |  -0.961 |  0.383 |   0.176 |
| Long Beach, CA     | victim_sexMale    |  -1.468 |  0.230 |   0.067 |
| Los Angeles, CA    | (Intercept)       |   0.819 |  2.269 |   0.035 |
| Los Angeles, CA    | victim_age        |  -0.003 |  0.997 |   0.589 |
| Los Angeles, CA    | victim_raceBlack  |  -0.427 |  0.652 |   0.079 |
| Los Angeles, CA    | victim_sexMale    |  -0.504 |  0.604 |   0.050 |
| Louisville, KY     | (Intercept)       |   1.846 |  6.335 |   0.000 |
| Louisville, KY     | victim_age        |  -0.012 |  0.988 |   0.162 |
| Louisville, KY     | victim_raceBlack  |  -0.734 |  0.480 |   0.015 |
| Louisville, KY     | victim_sexMale    |  -0.792 |  0.453 |   0.024 |
| Memphis, TN        | (Intercept)       |   1.746 |  5.733 |   0.000 |
| Memphis, TN        | victim_age        |  -0.015 |  0.985 |   0.007 |
| Memphis, TN        | victim_raceBlack  |  -0.139 |  0.870 |   0.630 |
| Memphis, TN        | victim_sexMale    |  -0.351 |  0.704 |   0.117 |
| Miami, FL          | (Intercept)       |   0.859 |  2.360 |   0.110 |
| Miami, FL          | victim_age        |  -0.007 |  0.993 |   0.492 |
| Miami, FL          | victim_raceBlack  |  -0.594 |  0.552 |   0.058 |
| Miami, FL          | victim_sexMale    |  -0.891 |  0.410 |   0.014 |
| Milwaukee, wI      | (Intercept)       |   1.888 |  6.609 |   0.000 |
| Milwaukee, wI      | victim_age        |  -0.013 |  0.987 |   0.042 |
| Milwaukee, wI      | victim_raceBlack  |  -0.695 |  0.499 |   0.047 |
| Milwaukee, wI      | victim_sexMale    |  -0.404 |  0.668 |   0.117 |
| Minneapolis, MN    | (Intercept)       |   0.437 |  1.548 |   0.566 |
| Minneapolis, MN    | victim_age        |  -0.005 |  0.995 |   0.664 |
| Minneapolis, MN    | victim_raceBlack  |  -0.869 |  0.419 |   0.085 |
| Minneapolis, MN    | victim_sexMale    |   0.549 |  1.731 |   0.259 |
| Nashville, TN      | (Intercept)       |   0.858 |  2.359 |   0.035 |
| Nashville, TN      | victim_age        |  -0.007 |  0.993 |   0.319 |
| Nashville, TN      | victim_raceBlack  |   0.020 |  1.020 |   0.934 |
| Nashville, TN      | victim_sexMale    |  -0.086 |  0.918 |   0.790 |
| New Orleans, LA    | (Intercept)       |   1.135 |  3.113 |   0.010 |
| New Orleans, LA    | victim_age        |  -0.019 |  0.981 |   0.007 |
| New Orleans, LA    | victim_raceBlack  |  -0.631 |  0.532 |   0.042 |
| New Orleans, LA    | victim_sexMale    |  -0.622 |  0.537 |   0.007 |
| New York, NY       | (Intercept)       |   2.927 | 18.678 |   0.000 |
| New York, NY       | victim_age        |   0.007 |  1.007 |   0.535 |
| New York, NY       | victim_raceBlack  |  -1.259 |  0.284 |   0.015 |
| New York, NY       | victim_sexMale    |  -2.069 |  0.126 |   0.000 |
| Oakland, CA        | (Intercept)       |   2.029 |  7.609 |   0.002 |
| Oakland, CA        | victim_age        |   0.001 |  1.001 |   0.887 |
| Oakland, CA        | victim_raceBlack  |  -1.882 |  0.152 |   0.000 |
| Oakland, CA        | victim_sexMale    |  -0.705 |  0.494 |   0.026 |
| Oklahoma City, OK  | (Intercept)       |   0.788 |  2.199 |   0.066 |
| Oklahoma City, OK  | victim_age        |  -0.008 |  0.992 |   0.372 |
| Oklahoma City, OK  | victim_raceBlack  |  -0.642 |  0.526 |   0.029 |
| Oklahoma City, OK  | victim_sexMale    |  -0.001 |  0.999 |   0.998 |
| Omaha, NE          | (Intercept)       |   2.322 | 10.201 |   0.001 |
| Omaha, NE          | victim_age        |   0.006 |  1.006 |   0.643 |
| Omaha, NE          | victim_raceBlack  |  -2.082 |  0.125 |   0.000 |
| Omaha, NE          | victim_sexMale    |  -1.041 |  0.353 |   0.023 |
| Philadelphia, PA   | (Intercept)       |   1.053 |  2.867 |   0.000 |
| Philadelphia, PA   | victim_age        |   0.002 |  1.002 |   0.678 |
| Philadelphia, PA   | victim_raceBlack  |  -0.341 |  0.711 |   0.092 |
| Philadelphia, PA   | victim_sexMale    |  -0.679 |  0.507 |   0.000 |
| Pittsburgh, PA     | (Intercept)       |   1.284 |  3.611 |   0.016 |
| Pittsburgh, PA     | victim_age        |   0.003 |  1.003 |   0.707 |
| Pittsburgh, PA     | victim_raceBlack  |  -1.201 |  0.301 |   0.003 |
| Pittsburgh, PA     | victim_sexMale    |  -0.555 |  0.574 |   0.086 |
| Richmond, VA       | (Intercept)       |   1.820 |  6.175 |   0.076 |
| Richmond, VA       | victim_age        |  -0.015 |  0.985 |   0.337 |
| Richmond, VA       | victim_raceBlack  |  -0.036 |  0.964 |   0.955 |
| Richmond, VA       | victim_sexMale    |  -0.340 |  0.712 |   0.535 |
| San Antonio, TX    | (Intercept)       |   1.370 |  3.936 |   0.024 |
| San Antonio, TX    | victim_age        |  -0.021 |  0.980 |   0.043 |
| San Antonio, TX    | victim_raceBlack  |  -0.148 |  0.863 |   0.673 |
| San Antonio, TX    | victim_sexMale    |  -0.296 |  0.744 |   0.462 |
| Sacramento, CA     | (Intercept)       |   0.622 |  1.863 |   0.385 |
| Sacramento, CA     | victim_age        |   0.012 |  1.012 |   0.376 |
| Sacramento, CA     | victim_raceBlack  |  -0.364 |  0.695 |   0.428 |
| Sacramento, CA     | victim_sexMale    |  -0.449 |  0.638 |   0.338 |
| Sacramento, CA     | victim_sexUnknown | -16.096 |  0.000 |   0.991 |
| Savannah, GA       | (Intercept)       |   0.194 |  1.214 |   0.818 |
| Savannah, GA       | victim_age        |   0.017 |  1.017 |   0.242 |
| Savannah, GA       | victim_raceBlack  |  -0.266 |  0.766 |   0.625 |
| Savannah, GA       | victim_sexMale    |  -0.624 |  0.536 |   0.243 |
| San Bernardino, CA | (Intercept)       |  -1.631 |  0.196 |   0.175 |
| San Bernardino, CA | victim_age        |   0.039 |  1.040 |   0.042 |
| San Bernardino, CA | victim_raceBlack  |   0.370 |  1.447 |   0.565 |
| San Bernardino, CA | victim_sexMale    |  -0.318 |  0.728 |   0.647 |
| San Diego, CA      | (Intercept)       |   2.023 |  7.561 |   0.014 |
| San Diego, CA      | victim_age        |  -0.011 |  0.989 |   0.380 |
| San Diego, CA      | victim_raceBlack  |  -0.502 |  0.605 |   0.229 |
| San Diego, CA      | victim_sexMale    |  -1.042 |  0.353 |   0.043 |
| San Francisco, CA  | (Intercept)       |   1.020 |  2.772 |   0.148 |
| San Francisco, CA  | victim_age        |   0.017 |  1.017 |   0.092 |
| San Francisco, CA  | victim_raceBlack  |  -0.855 |  0.425 |   0.014 |
| San Francisco, CA  | victim_sexMale    |  -0.910 |  0.403 |   0.096 |
| St. Louis, MO      | (Intercept)       |   0.518 |  1.678 |   0.148 |
| St. Louis, MO      | victim_age        |  -0.001 |  0.999 |   0.881 |
| St. Louis, MO      | victim_raceBlack  |  -0.344 |  0.709 |   0.161 |
| St. Louis, MO      | victim_sexMale    |  -0.445 |  0.641 |   0.022 |
| Stockton, CA       | (Intercept)       |   1.423 |  4.150 |   0.085 |
| Stockton, CA       | victim_age        |  -0.021 |  0.979 |   0.125 |
| Stockton, CA       | victim_raceBlack  |  -1.412 |  0.244 |   0.009 |
| Stockton, CA       | victim_sexMale    |   0.165 |  1.180 |   0.778 |
| Tampa, FL          | (Intercept)       |   0.215 |  1.240 |   0.829 |
| Tampa, FL          | victim_age        |   0.018 |  1.019 |   0.243 |
| Tampa, FL          | victim_raceBlack  |   0.041 |  1.042 |   0.945 |
| Tampa, FL          | victim_sexMale    |  -1.156 |  0.315 |   0.124 |
| Tulsa, OK          | (Intercept)       |   1.554 |  4.732 |   0.000 |
| Tulsa, OK          | victim_age        |  -0.008 |  0.992 |   0.359 |
| Tulsa, OK          | victim_raceBlack  |  -0.364 |  0.695 |   0.213 |
| Tulsa, OK          | victim_sexMale    |  -0.253 |  0.776 |   0.456 |
| Washington, DC     | (Intercept)       |   1.193 |  3.296 |   0.035 |
| Washington, DC     | victim_age        |  -0.003 |  0.997 |   0.643 |
| Washington, DC     | victim_raceBlack  |  -0.503 |  0.605 |   0.270 |
| Washington, DC     | victim_sexMale    |  -0.552 |  0.576 |   0.040 |
| Washington, DC     | victim_sexUnknown |   0.171 |  1.187 |   0.775 |

- Keeping all other variables fixed, in XXX,XXX,XXX, homicides in which
  the victim is male are significantly less like to be resolved than
  those in which the victim is female.

``` r
allcities_logistic %>% 
  filter(str_detect(term, "victim_sex")) %>% 
  ggplot(aes(x = city_state, y = exp(estimate))) + 
  geom_point() + 
  facet_wrap(~term) + 
  theme(axis.text.x = element_text(angle = 80, hjust = 1))
```

<img src="p8105_hw6_zs2539_files/figure-gfm/unnamed-chunk-7-1.png" width="90%" />
